machine:
  services:
    - docker

dependencies:
  pre:
    - mv /home/ubuntu/alpine/docker-build /home/ubuntu/bin/docker-build
    - chmod +x /home/ubuntu/bin/docker-build
  override:
    - docker-build pull || true
    - docker-build build

test:
  override:
    - "true"

deployment_dockerhub:
  github_release:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - docker-build push
      - docker images

deployment_aws_ecr:
  dockerhub_release:
    tag: /a[0-9]+(\.[0-9]+)*/
    commands:
      - docker-build push
      - docker images


